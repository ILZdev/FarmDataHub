<!DOCTYPE html>
<html lang="id" style="height: 100%">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dokumentasi Pertumbuhan Tanaman</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/_sdk/element_sdk.js"></script>
    <style>
      body {
        box-sizing: border-box;
      }

      .media-item {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .media-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .loading-spinner {
        border: 3px solid #f3f4f6;
        border-top: 3px solid #10b981;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .empty-state {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      }
    </style>
    <style>
      @view-transition {
        navigation: auto;
      }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  </head>
  <body
    style="
      height: 100%;
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    "
    class="bg-gray-50"
  >
    <div class="min-h-full">
      <!-- Header -->
      <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
          <div class="text-center">
            <h1 id="site-title" class="text-3xl font-bold text-gray-900 mb-2">
              Dokumentasi Pertumbuhan Tanaman
            </h1>
            <p id="subtitle" class="text-lg text-gray-600">
              Proyek Pertanian Digital
            </p>
          </div>
        </div>
      </header>
      <!-- Filters -->
      <div class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
          <!-- Filter Row 1: Commodity and Quick Time Filters -->
          <div
            class="flex flex-col lg:flex-row gap-4 items-center justify-center mb-4"
          >
            <!-- Commodity Filter -->
            <div class="flex items-center gap-2">
              <label
                id="commodity-label"
                for="commoditySelect"
                class="text-sm font-medium text-gray-700"
                >Pilih Komoditas:</label
              >
              <select
                id="commoditySelect"
                class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white text-gray-900"
              >
                <option value="all">Semua Komoditas</option>
              </select>
            </div>
            <!-- Quick Time Filter -->
            <div class="flex items-center gap-2">
              <label
                id="time-filter-label"
                for="timeFilter"
                class="text-sm font-medium text-gray-700"
                >Filter Cepat:</label
              >
              <select
                id="timeFilter"
                class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white text-gray-900"
              >
                <option value="all">Semua Waktu</option>
                <option value="today">Hari Ini</option>
                <option value="week">7 Hari Terakhir</option>
                <option value="month">30 Hari Terakhir</option>
              </select>
            </div>
            <!-- Calendar Toggle -->
            <button
              id="calendarToggle"
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center gap-2"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewbox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                ></path>
              </svg>
              Kalender
            </button>
            <!-- Refresh Button -->
            <button
              id="refreshBtn"
              class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center gap-2"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewbox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                ></path>
              </svg>
              Refresh
            </button>
          </div>
          <!-- Calendar Filter (Hidden by default) -->
          <div id="calendarFilter" class="bg-gray-50 rounded-lg p-4 hidden">
            <div
              class="flex flex-col sm:flex-row gap-4 items-center justify-center"
            >
              <div class="flex items-center gap-2">
                <label for="startDate" class="text-sm font-medium text-gray-700"
                  >Dari Tanggal:</label
                >
                <input
                  type="date"
                  id="startDate"
                  class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900"
                />
              </div>
              <div class="flex items-center gap-2">
                <label for="endDate" class="text-sm font-medium text-gray-700"
                  >Sampai Tanggal:</label
                >
                <input
                  type="date"
                  id="endDate"
                  class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900"
                />
              </div>
              <button
                id="applyDateFilter"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200"
              >
                Terapkan
              </button>
              <button
                id="clearDateFilter"
                class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors duration-200"
              >
                Reset
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Content Area -->
      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Loading State -->
        <div id="loadingState" class="flex justify-center items-center py-12">
          <div class="loading-spinner"></div>
          <span class="ml-3 text-gray-600">Memuat dokumentasi...</span>
        </div>
        <!-- Media Grid -->
        <div
          id="mediaGrid"
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 hidden"
        ></div>
        <!-- Empty State -->
        <div
          id="emptyState"
          class="empty-state rounded-xl p-12 text-center hidden"
        >
          <div
            class="mx-auto w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center mb-4"
          >
            <svg
              class="w-12 h-12 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewbox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
              ></path>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-2">
            Tidak Ada Dokumentasi
          </h3>
          <p class="text-gray-600 max-w-md mx-auto">
            Belum ada foto atau video untuk filter yang dipilih. Pastikan file
            dokumentasi tersedia di folder yang sesuai.
          </p>
        </div>
        <!-- Pagination -->
        <div id="paginationContainer" class="mt-8 flex justify-center hidden">
          <nav class="flex items-center gap-2">
            <button
              id="prevPage"
              class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewbox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                ></path>
              </svg>
            </button>
            <div id="pageNumbers" class="flex gap-1">
              <!-- Page numbers will be inserted here -->
            </div>
            <button
              id="nextPage"
              class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewbox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                ></path>
              </svg>
            </button>
          </nav>
        </div>
        <!-- Stats -->
        <div
          id="statsBar"
          class="mt-4 bg-white rounded-lg shadow-sm border border-gray-200 p-4 hidden"
        >
          <div
            class="flex flex-col sm:flex-row justify-center items-center gap-4 text-sm text-gray-600"
          >
            <div class="flex gap-6">
              <span id="totalItems">Total: 0 item</span>
              <span id="currentPageInfo">Halaman: 1</span>
            </div>
            <div class="flex gap-6">
              <span id="selectedCommodity">Komoditas: Semua</span>
              <span id="selectedTimeRange">Periode: Semua Waktu</span>
            </div>
          </div>
        </div>
      </main>
    </div>
    <!-- Modal for Media Preview -->
    <div
      id="mediaModal"
      class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden"
    >
      <div class="max-w-4xl max-h-full p-4">
        <div class="bg-white rounded-lg overflow-hidden">
          <div class="flex justify-between items-center p-4 border-b">
            <h3
              id="modalTitle"
              class="text-lg font-semibold text-gray-900"
            ></h3>
            <button id="closeModal" class="text-gray-400 hover:text-gray-600">
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewbox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                ></path>
              </svg>
            </button>
          </div>
          <div id="modalContent" class="p-4"></div>
        </div>
      </div>
    </div>
    <script>
      // Configuration
      const defaultConfig = {
        site_title: "Dokumentasi Pertumbuhan Tanaman",
        subtitle: "Proyek Pertanian Digital",
        commodity_label: "Pilih Komoditas",
        time_filter_label: "Filter Waktu",
      };

      // Sample data structure - in real implementation, this would be loaded from server
      const sampleData = {
        timun: [
          {
            filename: "2025-01-15.jpg",
            type: "image",
            date: "2025-01-15",
            title: "Timun - 15 Jan 2025",
            url: "https://i.pinimg.com/1200x/c4/b5/2d/c4b52d92c850a5bfe89e82e1b042427e.jpg",
          },
          {
            filename: "2025-01-14.mp4",
            type: "video",
            date: "2025-01-14",
            title: "Timun - 14 Jan 2025",
          },
          {
            filename: "2025-01-10.jpg",
            type: "image",
            date: "2025-01-10",
            title: "Timun - 10 Jan 2025",
            url: "https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=500",
          },
          {
            filename: "2025-01-08.jpg",
            type: "image",
            date: "2025-01-08",
            title: "Timun - 8 Jan 2025",
            url: "https://images.unsplash.com/photo-1604977042946-1eecc30f269e?w=500",
          },
        ],
        bawang: [
          {
            filename: "2025-01-15.jpg",
            type: "image",
            date: "2025-01-15",
            title: "Bawang Merah - 15 Jan 2025",
            url: "https://images.unsplash.com/photo-1618512496248-a07fe83aa8cb?w=500",
          },
          {
            filename: "2025-01-12.mp4",
            type: "video",
            date: "2025-01-12",
            title: "Bawang Merah - 12 Jan 2025",
          },
          {
            filename: "2025-01-09.jpg",
            type: "image",
            date: "2025-01-09",
            title: "Bawang Merah - 9 Jan 2025",
            url: "https://images.unsplash.com/photo-1508747703725-719777637510?w=500",
          },
        ],
        cabai: [
          {
            filename: "2025-01-16.jpg",
            type: "image",
            date: "2025-01-16",
            title: "Cabai - 16 Jan 2025",
            url: "https://images.unsplash.com/photo-1583663848850-46af132dc08e?w=500",
          },
          {
            filename: "2025-01-13.jpg",
            type: "image",
            date: "2025-01-13",
            title: "Cabai - 13 Jan 2025",
            url: "https://images.unsplash.com/photo-1525663706387-bd4c3c01b9cb?w=500",
          },
          {
            filename: "2025-01-11.mp4",
            type: "video",
            date: "2025-01-11",
            title: "Cabai - 11 Jan 2025",
          },
        ],
      };

      // State
      let currentData = [];
      let filteredData = [];
      let paginatedData = [];
      let currentPage = 1;
      let itemsPerPage = 12;
      let totalPages = 1;
      let customDateRange = null;

      // DOM Elements
      const commoditySelect = document.getElementById("commoditySelect");
      const timeFilter = document.getElementById("timeFilter");
      const refreshBtn = document.getElementById("refreshBtn");
      const calendarToggle = document.getElementById("calendarToggle");
      const calendarFilter = document.getElementById("calendarFilter");
      const startDate = document.getElementById("startDate");
      const endDate = document.getElementById("endDate");
      const applyDateFilter = document.getElementById("applyDateFilter");
      const clearDateFilter = document.getElementById("clearDateFilter");
      const loadingState = document.getElementById("loadingState");
      const mediaGrid = document.getElementById("mediaGrid");
      const emptyState = document.getElementById("emptyState");
      const statsBar = document.getElementById("statsBar");
      const paginationContainer = document.getElementById(
        "paginationContainer"
      );
      const prevPage = document.getElementById("prevPage");
      const nextPage = document.getElementById("nextPage");
      const pageNumbers = document.getElementById("pageNumbers");
      const mediaModal = document.getElementById("mediaModal");
      const modalTitle = document.getElementById("modalTitle");
      const modalContent = document.getElementById("modalContent");
      const closeModal = document.getElementById("closeModal");

      // Initialize
      function init() {
        loadCommodities();
        loadData();
        setupEventListeners();
      }

      function loadCommodities() {
        // Clear existing options except "Semua Komoditas"
        commoditySelect.innerHTML =
          '<option value="all">Semua Komoditas</option>';

        // Add commodity options
        Object.keys(sampleData).forEach((commodity) => {
          const option = document.createElement("option");
          option.value = commodity;
          option.textContent = capitalizeFirst(commodity);
          commoditySelect.appendChild(option);
        });
      }

      function loadData() {
        showLoading();

        // Simulate loading delay
        setTimeout(() => {
          currentData = [];

          // Flatten all commodity data
          Object.keys(sampleData).forEach((commodity) => {
            sampleData[commodity].forEach((item) => {
              currentData.push({
                ...item,
                commodity: commodity,
                path: `/assets/${commodity}/${item.filename}`,
              });
            });
          });

          // Sort by date (newest first)
          currentData.sort((a, b) => new Date(b.date) - new Date(a.date));

          applyFilters();
          hideLoading();
        }, 800);
      }

      function applyFilters() {
        const selectedCommodity = commoditySelect.value;
        const selectedTimeFilter = timeFilter.value;

        filteredData = currentData.filter((item) => {
          // Commodity filter
          if (
            selectedCommodity !== "all" &&
            item.commodity !== selectedCommodity
          ) {
            return false;
          }

          const itemDate = new Date(item.date);

          // Custom date range filter (takes priority)
          if (customDateRange) {
            return (
              itemDate >= customDateRange.start &&
              itemDate <= customDateRange.end
            );
          }

          // Quick time filter
          if (selectedTimeFilter !== "all") {
            const now = new Date();

            switch (selectedTimeFilter) {
              case "today":
                return itemDate.toDateString() === now.toDateString();
              case "week":
                const weekAgo = new Date(
                  now.getTime() - 7 * 24 * 60 * 60 * 1000
                );
                return itemDate >= weekAgo;
              case "month":
                const monthAgo = new Date(
                  now.getTime() - 30 * 24 * 60 * 60 * 1000
                );
                return itemDate >= monthAgo;
            }
          }

          return true;
        });

        // Reset to first page when filters change
        currentPage = 1;

        applyPagination();
        renderMediaGrid();
        renderPagination();
        updateStats();
      }

      function applyPagination() {
        totalPages = Math.ceil(filteredData.length / itemsPerPage);
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        paginatedData = filteredData.slice(startIndex, endIndex);
      }

      function renderMediaGrid() {
        mediaGrid.innerHTML = "";

        if (paginatedData.length === 0) {
          showEmptyState();
          hidePagination();
          return;
        }

        hideEmptyState();
        showPagination();

        paginatedData.forEach((item) => {
          const mediaItem = createMediaItem(item);
          mediaGrid.appendChild(mediaItem);
        });

        // Add fade-in animation
        mediaGrid.classList.add("fade-in");
        setTimeout(() => mediaGrid.classList.remove("fade-in"), 500);
      }

      function createMediaItem(item) {
        const div = document.createElement("div");
        div.className =
          "media-item bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden cursor-pointer";

        const isVideo = item.type === "video";
        const formattedDate = formatDate(item.date);

        div.innerHTML = `
                <div class="aspect-square bg-gray-100 flex items-center justify-center relative overflow-hidden">
                    ${
                      isVideo
                        ? `<div class="w-full h-full bg-gray-200 flex items-center justify-center">
                            <svg class="w-16 h-16 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            <div class="absolute top-2 right-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded">
                                VIDEO
                            </div>
                        </div>`
                        : item.url
                        ? `<img src="${item.url}" alt="${item.title}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                         <div class="w-full h-full bg-gray-200 flex items-center justify-center" style="display: none;">
                            <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                         </div>`
                        : `<div class="w-full h-full bg-gray-200 flex items-center justify-center">
                            <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>`
                    }
                </div>
                <div class="p-4">
                    <h3 class="font-semibold text-gray-900 text-sm mb-1">${capitalizeFirst(
                      item.commodity
                    )}</h3>
                    <p class="text-gray-600 text-xs">${formattedDate}</p>
                </div>
            `;

        div.addEventListener("click", () => openModal(item));

        return div;
      }

      function openModal(item) {
        modalTitle.textContent = item.title;

        const isVideo = item.type === "video";
        modalContent.innerHTML = `
                <div class="text-center">
                    ${
                      isVideo
                        ? `<div class="bg-gray-100 rounded-lg p-8 mb-4">
                            <svg class="w-24 h-24 text-gray-400 mx-auto mb-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            <p class="text-gray-600">Video: ${item.filename}</p>
                            <p class="text-sm text-gray-500 mt-2">Preview video tidak tersedia dalam demo ini</p>
                        </div>`
                        : item.url
                        ? `<div class="mb-4">
                            <img src="${item.url}" alt="${item.title}" class="max-w-full max-h-96 mx-auto rounded-lg shadow-lg" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="bg-gray-100 rounded-lg p-8" style="display: none;">
                                <svg class="w-24 h-24 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <p class="text-gray-600">Gagal memuat gambar</p>
                            </div>
                        </div>`
                        : `<div class="bg-gray-100 rounded-lg p-8 mb-4">
                            <svg class="w-24 h-24 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <p class="text-gray-600">Foto: ${item.filename}</p>
                            <p class="text-sm text-gray-500 mt-2">URL gambar tidak tersedia</p>
                        </div>`
                    }
                    <div class="text-left bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-900 mb-2">Detail Dokumentasi</h4>
                        <div class="space-y-1 text-sm text-gray-600">
                            <p><span class="font-medium">Komoditas:</span> ${capitalizeFirst(
                              item.commodity
                            )}</p>
                            <p><span class="font-medium">Tanggal:</span> ${formatDate(
                              item.date
                            )}</p>
                            <p><span class="font-medium">File:</span> ${
                              item.filename
                            }</p>
                            <p><span class="font-medium">Path:</span> ${
                              item.path
                            }</p>
                            ${
                              item.url
                                ? `<p><span class="font-medium">URL:</span> <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 break-all">${item.url}</a></p>`
                                : ""
                            }
                        </div>
                    </div>
                </div>
            `;

        mediaModal.classList.remove("hidden");
      }

      function renderPagination() {
        if (totalPages <= 1) {
          hidePagination();
          return;
        }

        showPagination();

        // Update navigation buttons
        prevPage.disabled = currentPage === 1;
        nextPage.disabled = currentPage === totalPages;

        // Generate page numbers
        pageNumbers.innerHTML = "";

        const maxVisiblePages = 5;
        let startPage = Math.max(
          1,
          currentPage - Math.floor(maxVisiblePages / 2)
        );
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        // Adjust start page if we're near the end
        if (endPage - startPage < maxVisiblePages - 1) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        // Add first page and ellipsis if needed
        if (startPage > 1) {
          addPageButton(1);
          if (startPage > 2) {
            addEllipsis();
          }
        }

        // Add visible page numbers
        for (let i = startPage; i <= endPage; i++) {
          addPageButton(i);
        }

        // Add ellipsis and last page if needed
        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            addEllipsis();
          }
          addPageButton(totalPages);
        }
      }

      function addPageButton(pageNum) {
        const button = document.createElement("button");
        button.className = `px-3 py-2 text-sm font-medium rounded-lg transition-colors duration-200 ${
          pageNum === currentPage
            ? "bg-blue-600 text-white"
            : "text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"
        }`;
        button.textContent = pageNum;
        button.addEventListener("click", () => goToPage(pageNum));
        pageNumbers.appendChild(button);
      }

      function addEllipsis() {
        const ellipsis = document.createElement("span");
        ellipsis.className = "px-3 py-2 text-sm text-gray-500";
        ellipsis.textContent = "...";
        pageNumbers.appendChild(ellipsis);
      }

      function goToPage(pageNum) {
        if (pageNum >= 1 && pageNum <= totalPages && pageNum !== currentPage) {
          currentPage = pageNum;
          applyPagination();
          renderMediaGrid();
          renderPagination();
          updateStats();

          // Scroll to top of grid
          mediaGrid.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }

      function showPagination() {
        paginationContainer.classList.remove("hidden");
      }

      function hidePagination() {
        paginationContainer.classList.add("hidden");
      }

      function updateStats() {
        const totalItems = filteredData.length;
        const selectedCommodity = commoditySelect.value;
        const selectedTimeRange = timeFilter.value;

        document.getElementById(
          "totalItems"
        ).textContent = `Total: ${totalItems} item`;
        document.getElementById(
          "currentPageInfo"
        ).textContent = `Halaman: ${currentPage} dari ${totalPages}`;
        document.getElementById(
          "selectedCommodity"
        ).textContent = `Komoditas: ${
          selectedCommodity === "all"
            ? "Semua"
            : capitalizeFirst(selectedCommodity)
        }`;

        if (customDateRange) {
          const startStr = customDateRange.start.toLocaleDateString("id-ID", {
            day: "numeric",
            month: "short",
          });
          const endStr = customDateRange.end.toLocaleDateString("id-ID", {
            day: "numeric",
            month: "short",
          });
          document.getElementById(
            "selectedTimeRange"
          ).textContent = `Periode: ${startStr} - ${endStr}`;
        } else {
          document.getElementById(
            "selectedTimeRange"
          ).textContent = `Periode: ${getTimeRangeLabel(selectedTimeRange)}`;
        }

        if (totalItems > 0) {
          statsBar.classList.remove("hidden");
        } else {
          statsBar.classList.add("hidden");
        }
      }

      function setupEventListeners() {
        commoditySelect.addEventListener("change", applyFilters);
        timeFilter.addEventListener("change", () => {
          // Clear custom date range when using quick filters
          if (timeFilter.value !== "all") {
            customDateRange = null;
            startDate.value = "";
            endDate.value = "";
          }
          applyFilters();
        });
        refreshBtn.addEventListener("click", loadData);

        // Calendar toggle
        calendarToggle.addEventListener("click", () => {
          calendarFilter.classList.toggle("hidden");
        });

        // Date filter controls
        applyDateFilter.addEventListener("click", () => {
          const start = startDate.value;
          const end = endDate.value;

          if (start && end) {
            const startDateObj = new Date(start);
            const endDateObj = new Date(end);

            if (startDateObj <= endDateObj) {
              customDateRange = {
                start: startDateObj,
                end: endDateObj,
              };
              // Clear quick filter when using custom date range
              timeFilter.value = "all";
              applyFilters();
            } else {
              showToast(
                "Tanggal mulai harus lebih kecil dari tanggal akhir",
                "error"
              );
            }
          } else {
            showToast("Silakan pilih tanggal mulai dan akhir", "warning");
          }
        });

        clearDateFilter.addEventListener("click", () => {
          customDateRange = null;
          startDate.value = "";
          endDate.value = "";
          applyFilters();
          showToast("Filter tanggal telah direset", "success");
        });

        // Pagination controls
        prevPage.addEventListener("click", () => {
          if (currentPage > 1) {
            goToPage(currentPage - 1);
          }
        });

        nextPage.addEventListener("click", () => {
          if (currentPage < totalPages) {
            goToPage(currentPage + 1);
          }
        });

        // Modal controls
        closeModal.addEventListener("click", () => {
          mediaModal.classList.add("hidden");
        });

        mediaModal.addEventListener("click", (e) => {
          if (e.target === mediaModal) {
            mediaModal.classList.add("hidden");
          }
        });
      }

      function showToast(message, type = "info") {
        // Create toast element
        const toast = document.createElement("div");
        toast.className = `fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg text-white transition-all duration-300 transform translate-x-full ${
          type === "success"
            ? "bg-green-600"
            : type === "error"
            ? "bg-red-600"
            : type === "warning"
            ? "bg-yellow-600"
            : "bg-blue-600"
        }`;
        toast.textContent = message;

        document.body.appendChild(toast);

        // Animate in
        setTimeout(() => {
          toast.classList.remove("translate-x-full");
        }, 100);

        // Remove after 3 seconds
        setTimeout(() => {
          toast.classList.add("translate-x-full");
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 300);
        }, 3000);
      }

      function showLoading() {
        loadingState.classList.remove("hidden");
        mediaGrid.classList.add("hidden");
        emptyState.classList.add("hidden");
        statsBar.classList.add("hidden");
      }

      function hideLoading() {
        loadingState.classList.add("hidden");
        mediaGrid.classList.remove("hidden");
      }

      function showEmptyState() {
        mediaGrid.classList.add("hidden");
        emptyState.classList.remove("hidden");
      }

      function hideEmptyState() {
        emptyState.classList.add("hidden");
        mediaGrid.classList.remove("hidden");
      }

      // Utility functions
      function capitalizeFirst(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
      }

      function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString("id-ID", {
          day: "numeric",
          month: "long",
          year: "numeric",
        });
      }

      function getTimeRangeLabel(range) {
        switch (range) {
          case "today":
            return "Hari Ini";
          case "week":
            return "7 Hari Terakhir";
          case "month":
            return "30 Hari Terakhir";
          default:
            return "Semua Waktu";
        }
      }

      // Element SDK Configuration
      async function onConfigChange(config) {
        const siteTitle = config.site_title || defaultConfig.site_title;
        const subtitle = config.subtitle || defaultConfig.subtitle;
        const commodityLabel =
          config.commodity_label || defaultConfig.commodity_label;
        const timeFilterLabel =
          config.time_filter_label || defaultConfig.time_filter_label;

        document.getElementById("site-title").textContent = siteTitle;
        document.getElementById("subtitle").textContent = subtitle;
        document.getElementById("commodity-label").textContent =
          commodityLabel + ":";
        document.getElementById("time-filter-label").textContent =
          timeFilterLabel + ":";
      }

      function mapToCapabilities(config) {
        return {
          recolorables: [
            {
              get: () => config.primary_color || "#10b981",
              set: (value) => {
                config.primary_color = value;
                if (window.elementSdk) {
                  window.elementSdk.setConfig({ primary_color: value });
                }
              },
            },
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined,
        };
      }

      function mapToEditPanelValues(config) {
        return new Map([
          ["site_title", config.site_title || defaultConfig.site_title],
          ["subtitle", config.subtitle || defaultConfig.subtitle],
          [
            "commodity_label",
            config.commodity_label || defaultConfig.commodity_label,
          ],
          [
            "time_filter_label",
            config.time_filter_label || defaultConfig.time_filter_label,
          ],
        ]);
      }

      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues,
        });
      }

      // Initialize app
      init();
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'9985c644a34bfdb2',t:'MTc2MjEwODk3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
